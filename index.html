<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oppa | Elite Tasker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: sans-serif; -webkit-tap-highlight-color: transparent; }
        .cube-checkbox { width: 22px; height: 22px; border: 2px solid #475569; cursor: pointer; position: relative; flex-shrink: 0; }
        .cube-checkbox.checked { background-color: #10b981; border-color: #10b981; }
        .cube-checkbox.checked::after { content: 'âœ”'; color: white; position: absolute; top: -2px; left: 3px; font-size: 14px; }
        .calendar-day { min-height: 55px; background: #1e293b; cursor: pointer; border: 2px solid transparent; border-radius: 8px; position: relative; }
        .calendar-day.active { border-color: #3b82f6; background: #0f172a; }
        .calendar-day.today { border: 1px solid #3b82f6; font-weight: bold; }
        .dot { width: 6px; height: 6px; background-color: #3b82f6; border-radius: 50%; position: absolute; bottom: 8px; }
        .sub-task-container { margin-left: 28px; border-left: 2px solid #334155; padding-left: 12px; margin-top: 8px; }
        .progress-bar { height: 8px; background: #1e293b; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: #10b981; transition: width 0.3s ease; }
        input[type="text"] { background: #1e293b; border: 1px solid #334155; color: #e2e8f0; padding: 4px 8px; border-radius: 4px; width: 100%; font-size: 14px; }
        input[type="text"]:focus { outline: none; border-color: #3b82f6; }
    </style>
</head>
<body class="p-4 pb-24">
    <div class="max-w-md mx-auto">
        <div class="bg-gradient-to-r from-red-900 to-slate-900 p-3 rounded-lg mb-4 border border-red-800 shadow-lg text-center">
            <p class="text-[10px] font-black tracking-widest text-red-400 uppercase">CA Foundation Countdown</p>
            <h2 id="countdownDisplay" class="text-xl font-bold text-white tracking-tight">79 DAYS LEFT</h2>
        </div>

        <header class="flex justify-between items-center mb-6 border-b border-slate-700 pb-4">
            <h1 class="text-2xl font-bold italic tracking-tighter">OPPA <span class="text-blue-500 text-xs border border-blue-500 px-1 rounded not-italic uppercase">Elite</span></h1>
        </header>

        <div class="bg-slate-900 p-4 rounded-xl mb-6 border border-slate-800 shadow-xl">
            <div class="flex justify-between items-end mb-2">
                <p class="text-xs font-bold text-slate-400 uppercase">Weekly Efficiency</p>
                <p id="statsText" class="text-xs font-bold text-blue-400">0/0 Tasks</p>
            </div>
            <div class="progress-bar"><div id="progressFill" class="progress-fill" style="width: 0%"></div></div>
        </div>

        <div class="bg-slate-900 p-4 rounded-xl mb-6 shadow-2xl border border-slate-800">
            <div class="flex justify-between items-center mb-4">
                <button onclick="changeMonth(-1)" class="p-2 text-slate-400 font-bold text-xl">â—€</button>
                <div id="monthLabel" class="font-bold text-lg text-slate-200 uppercase tracking-widest text-center"></div>
                <button onclick="changeMonth(1)" class="p-2 text-slate-400 font-bold text-xl">â–¶</button>
            </div>
            <div class="grid grid-cols-7 gap-1 text-center text-[10px] text-slate-500 font-black mb-2">
                <div>SUN</div><div>MON</div><div>TUE</div><div>WED</div><div>THU</div><div>FRI</div><div>SAT</div>
            </div>
            <div id="calendarGrid" class="grid grid-cols-7 gap-1"></div>
        </div>

        <div class="bg-slate-900 p-5 rounded-xl shadow-2xl border border-slate-800 mb-6">
            <h2 id="viewDate" class="text-sm font-black mb-4 text-blue-500 uppercase tracking-tighter">Selected Date</h2>
            
            <div class="mb-6">
                <input type="text" id="mainTaskInput" placeholder="+ Add Main Goal (Press Enter)" onkeypress="handleMainKey(event)">
            </div>

            <div id="taskList" class="space-y-6"></div>
        </div>

        <div class="bg-slate-900 p-4 rounded-xl border border-slate-800 opacity-60 flex gap-2">
            <button onclick="downloadBackup()" class="flex-1 bg-slate-800 text-[10px] py-2 rounded font-bold hover:bg-slate-700 uppercase">ðŸ’¾ Download</button>
            <label class="flex-1 bg-slate-800 text-[10px] py-2 rounded font-bold text-center cursor-pointer hover:bg-slate-700 uppercase">
                ðŸ“‚ Restore <input type="file" class="hidden" onchange="restoreBackup(event)">
            </label>
        </div>
    </div>

    <script>
        let tasks = JSON.parse(localStorage.getItem('oppa_tasks')) || {};
        let currentViewDate = new Date();
        let selectedDate = new Date().toISOString().split('T')[0];
        const EXAM_DATE = new Date(2026, 4, 15);

        function updateCountdown() {
            const now = new Date();
            const diff = EXAM_DATE - now;
            const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
            document.getElementById('countdownDisplay').innerText = days > 0 ? `${days} DAYS LEFT` : "EXAM DAY!";
        }

        function updateProgress() {
            let done = 0, total = 0;
            const now = new Date();
            const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay()));
            for (let i = 0; i < 7; i++) {
                const dateStr = new Date(startOfWeek).toISOString().split('T')[0];
                if (tasks[dateStr]) {
                    tasks[dateStr].forEach(t => {
                        total++; if(t.done) done++;
                        t.subs.forEach(s => { total++; if(s.done) done++; });
                    });
                }
                startOfWeek.setDate(startOfWeek.getDate() + 1);
            }
            const percent = total === 0 ? 0 : (done / total) * 100;
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('statsText').innerText = `${done}/${total} COMPLETED`;
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const label = document.getElementById('monthLabel');
            grid.innerHTML = '';
            const year = currentViewDate.getFullYear();
            const month = currentViewDate.getMonth();
            label.innerText = new Intl.DateTimeFormat('en-US', { month: 'long', year: 'numeric' }).format(currentViewDate).toUpperCase();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            for (let i = 0; i < firstDay; i++) grid.appendChild(document.createElement('div'));
            for (let i = 1; i <= daysInMonth; i++) {
                const dateStr = `${year}-${(month + 1).toString().padStart(2, '0')}-${i.toString().padStart(2, '0')}`;
                const day = document.createElement('div');
                const isToday = new Date().toISOString().split('T')[0] === dateStr;
                day.className = `calendar-day flex items-center justify-center ${selectedDate === dateStr ? 'active' : ''} ${isToday ? 'today' : ''}`;
                day.innerHTML = `<span class="text-xs">${i}</span>`;
                if (tasks[dateStr] && tasks[dateStr].some(t => !t.done)) {
                    const dot = document.createElement('div'); dot.className = 'dot'; day.appendChild(dot);
                }
                day.onclick = () => { selectedDate = dateStr; renderCalendar(); renderTasks(); };
                grid.appendChild(day);
            }
        }

        function changeMonth(offset) { currentViewDate.setMonth(currentViewDate.getMonth() + offset); renderCalendar(); }

        function renderTasks() {
            const list = document.getElementById('taskList');
            document.getElementById('viewDate').innerText = selectedDate;
            list.innerHTML = '';
            const dayTasks = tasks[selectedDate] || [];
            
            dayTasks.forEach((task, tIdx) => {
                const taskDiv = document.createElement('div');
                let subHtml = task.subs.map((s, sIdx) => `
                    <div class="flex items-center gap-3 mb-2">
                        <div class="cube-checkbox scale-75 ${s.done ? 'checked' : ''}" onclick="toggleSub(${tIdx}, ${sIdx})"></div>
                        <p class="text-xs ${s.done ? 'line-through text-slate-500' : 'text-slate-400'}">${s.text}</p>
                    </div>
                `).join('');
                
                taskDiv.innerHTML = `<div class="p-3 bg-slate-800 rounded-lg border-l-4 border-blue-600 shadow-md">
                    <div class="flex items-start gap-3">
                        <div class="cube-checkbox ${task.done ? 'checked' : ''}" onclick="toggleMain(${tIdx})"></div>
                        <div class="flex-grow">
                            <p class="text-sm font-bold ${task.done ? 'line-through text-slate-600' : 'text-slate-100'}">${task.text}</p>
                            <div class="sub-task-container">
                                ${subHtml}
                                <div class="mt-2">
                                    <input type="text" class="sub-input" placeholder="+ Add Step" onkeypress="handleSubKey(event, ${tIdx})">
                                </div>
                            </div>
                        </div>
                        <button onclick="deleteTask(${tIdx})" class="text-slate-600 text-xs">X</button>
                    </div>
                </div>`;
                list.appendChild(taskDiv);
            });
            updateProgress();
        }

        function handleMainKey(e) {
            if (e.key === 'Enter') {
                const val = e.target.value;
                if (!val) return;
                if (!tasks[selectedDate]) tasks[selectedDate] = [];
                tasks[selectedDate].push({ text: val, done: false, subs: [] });
                e.target.value = '';
                save(); renderCalendar();
            }
        }

        function handleSubKey(e, tIdx) {
            if (e.key === 'Enter') {
                const val = e.target.value;
                if (!val) return;
                tasks[selectedDate][tIdx].subs.push({ text: val, done: false });
                e.target.value = '';
                save();
            }
        }

        function toggleMain(tIdx) { tasks[selectedDate][tIdx].done = !tasks[selectedDate][tIdx].done; save(); renderCalendar(); }
        function toggleSub(tIdx, sIdx) { tasks[selectedDate][tIdx].subs[sIdx].done = !tasks[selectedDate][tIdx].subs[sIdx].done; save(); }
        function deleteTask(tIdx) { if(confirm("Delete mission?")) { tasks[selectedDate].splice(tIdx, 1); save(); renderCalendar(); } }
        function save() { localStorage.setItem('oppa_tasks', JSON.stringify(tasks)); renderTasks(); }
        function downloadBackup() { const blob = new Blob([JSON.stringify(tasks)], { type: 'application/json' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = `oppa_elite_backup.json`; a.click(); }
        function restoreBackup(event) { const reader = new FileReader(); reader.onload = (e) => { tasks = JSON.parse(e.target.result); save(); renderCalendar(); }; reader.readAsText(event.target.files[0]); }

        updateCountdown();
        renderCalendar();
        renderTasks();
    </script>
</body>
</html>
